---
title: "CSLS Lake Metrics - Sensitivity Analysis"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Defining Average Seasonal Lake Levels}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
library(CSLSlevels)
library(lubridate)
library(dplyr)
library(ggplot2)
library(patchwork)
library(extrafont)

lakes           <- c("Pleasant", "Long", "Plainfield")
csls_levels     <- CSLSlevels::csls_levels
csls_levels_all <- csls_levels %>% filter(lake %in% lakes)
csls_levels     <- csls_levels %>% filter(year(date) <= 2018, year(date) >= 1981)

text_size <- 24
```

```{r levels, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.width=12, fig.height=5}
p1 <- plot_levels(csls_levels_all, text_size = text_size)
p2 <- plot_magnitudes(csls_levels, )

```


```{r levels, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.width=12, fig.height=5}

p1 <- plot_levels(csls_levels_all, 
                  text_size = text_size)
p2 <- plot_levels(csls_levels, 
                  text_size = text_size, 
                  legend_pos = c(0.25,0.95))
p3 <- plot_magnitude(csls_levels, 
                     text_size = text_size)
p
```

```{r magnitude, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.width=12, fig.height=5}
# magnitudes (no call outs)
p2a <- plot_levels(lake_levels, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95))
p2b <- plot_magnitude(lake_levels, text_size = text_size)
p2 <- p2a + p2b

# 50% exceedance level
p3a <- plot_levels(lake_levels, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95),
                   yintercept = p50)
p3b <- plot_magnitude(lake_levels, 
                      text_size = text_size, 
                      xintercept = p50)
p3 <- p3a + p3b

# 90% exceedance level
p4a <- plot_levels(lake_levels, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95),
                   yintercept = p90)
p4b <- plot_magnitude(lake_levels, 
                      text_size = text_size, 
                      xintercept = p90)
p4 <- p4a + p4b

# 10% exceedance level
p5a <- plot_levels(lake_levels, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95),
                   yintercept = p10)
p5b <- plot_magnitude(lake_levels, 
                      text_size = text_size, 
                      xintercept = p10)
p5 <- p5a + p5b

p2
p3
p4
p5
```

```{r duration, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.width=12, fig.height=5}
# 90% exceedance level
p6a <- plot_levels(lake_levels_all, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95),
                   yintercept = p90)
p6b <- plot_duration(lake_levels_all, 
                     lakes = lake, 
                     exceedance = 0.9, 
                     show_median = FALSE,
                     text_size = text_size)
p6  <- p6a + p6b

# 90% exceedance level - show median
p6a <- plot_levels(lake_levels_all, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95),
                   yintercept = p90)
p6b <- plot_duration(lake_levels_all, 
                     lakes = lake, 
                     exceedance = 0.9, 
                     show_median = TRUE,
                     text_size = text_size)
p6_median  <- p6a + p6b

# 10% exceedance level
p7a <- plot_levels(lake_levels_all, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95),
                   yintercept = p10)
p7b <- plot_duration(lake_levels_all, 
                     lakes = lake, 
                     exceedance = 0.1, 
                     show_median = FALSE,
                     text_size = text_size)
p7  <- p7a + p7b

# 10% exceedance level - show median
p7a <- plot_levels(lake_levels_all, 
                   text_size = text_size, 
                   legend_pos = c(0.25,0.95),
                   yintercept = p10)
p7b <- plot_duration(lake_levels_all, 
                     lakes = lake, 
                     exceedance = 0.1, 
                     show_median = TRUE,
                     text_size = text_size)
p7_median  <- p7a + p7b

p6
p6_median
p7
p7_median
```

```{r save, eval=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
ggsave(filename = "lake_levels_all.png",
       plot = p1,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in")

ggsave(filename = "level_hist.png",
       plot = p2,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in")

ggsave(filename = "level_hist_p50.png",
       plot = p3,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in") 

ggsave(filename = "level_hist_p90.png",
       plot = p4,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in") 

ggsave(filename = "level_hist_p10.png",
       plot = p5,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in")

ggsave(filename = "duration_hist_p90.png",
       plot = p6,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in") 

ggsave(filename = "duration_hist_p90_median.png",
       plot = p6_median,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in") 

ggsave(filename = "duration_hist_p10.png",
       plot = p7,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in") 

ggsave(filename = "duration_hist_p10_median.png",
       plot = p7_median,
       path = "doc/figures",
       width = 12,
       height = 5,
       units = "in")
```


